<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport"
	      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>å®åœ°å¸¸æ˜¥è—¤3æœŸ</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			display: block;
			/*outline: 1px solid red;*/
		}
	</style>
</head>
<body>
<canvas id="canvas"></canvas>
latitude-x;
longitude-y;
<script title="æ•°æ®">
    let northernLatitude = Math.cos(Math.PI * (23.209017141700002 / 180));
    // console.log('å½“å‰çº¬åº¦ä¸‹,æ¯ä¸ªç»åº¦ç›¸å½“äº  ' + northernLatitude + '  ä¸ªçº¬åº¦');

    //  å››ä¸ªè§’è½çš„åæ ‡
    const corner = (function () {
        return {
            topLeft: {
                latitude: 113.5491138697,
                longitude: 23.2105553933,
            },
            topRight: {
                latitude: 113.5530728102,
                longitude: 23.2105553933,
            },
            bottomLeft: {
                latitude: 113.5491138697,
                longitude: 23.2074838205,
            },
            bottomRight: {
                latitude: 113.5530728102,
                longitude: 23.2074838205,
            },
        };
    }());

    //  ä¸­å›½å†œå¤§
    const ChinaAgriculturalUniversityPoints1 = {
        longitude: unescape("40%B00'16.96\""),
        latitude: unescape("116%B021'7.49\""),
    };
    //  å¤©å®‰é—¨
    const ChinaAgriculturalUniversityPoints2 = {
        longitude: unescape("39%B054'9.32\""),
        latitude: unescape("116%B023'30.84\""),
    };
    //  åŒ—äº¬ç«™
    const ChinaAgriculturalUniversityPoints3 = {
        longitude: unescape("39%B054'5.44\""),
        latitude: unescape("116%B025'15.82\""),
    };
    //  åŒ—äº¬ä¸œç«™
    const ChinaAgriculturalUniversityPoints4 = {
        longitude: unescape("39%B054'5.79\""),
        latitude: unescape("116%B028'45.16\""),
    };
    //  èµ·å§‹ç‚¹ å®åœ°é’è—¤èŠ±å›­
    const StartPoint = {
        latitude: 113.5515117645,
        longitude: 23.2080803915,
    };

    //  æ•°æ®çš„list
    const pointsList = [StartPoint,
        ChinaAgriculturalUniversityPoints1,
        ChinaAgriculturalUniversityPoints2,
        ChinaAgriculturalUniversityPoints3,
        ChinaAgriculturalUniversityPoints4];

</script>
<script title="å·¥å…·ç±»">
    //  è½¬æ¢å…¨éƒ¨æ•°æ®
    /**
     * @originData : è¦è¢«ä»å­—ç¬¦ä¸²è½¬ä¸ºå°æ•°ç‚¹çš„å¯¹è±¡ , ç»è¿‡ x northernLatitude å¤„ç†  [data:[string]]
     * */
    function transformOriginData(originData) {
        let data = {};
        for (let key in originData) {
            if (originData.hasOwnProperty(key)) {
                data[key] = {};
                data[key].latitude = originData[key].latitude * northernLatitude;
                data[key].longitude = originData[key].longitude;
            }
        }
        return data;
    }

    //  è·å–ç¬›å¡å°”åæ ‡ç³»çš„ç»å¯¹å·®å€¼                       ğŸ‘ŒğŸ‘Œçº¯å‡½æ•°
    function getDiffer(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    //  æ±‚ä¸¤ç‚¹è¿çº¿çš„æ–¹ç¨‹                                ğŸ‘ŒğŸ‘Œçº¯å‡½æ•°
    function getK_B(x1, y1, x2, y2) {
        let k = (y2 - y1) / (x2 - x1);
		console.log(k);
        let b = y1 - k * x1;
        return {
            k: k,
            b: b
        }
    }

    //  å·²çŸ¥,x,y,k,æ±‚ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„b                      ğŸ‘ŒğŸ‘Œçº¯å‡½æ•°
    function get_B(x, y, k) {
        return y - k * x;
    }

    //  è”ç«‹æ–¹ç¨‹,æ±‚ç„¦ç‚¹åæ ‡  çº¯å‡½æ•°
    function getFocalCoordinates(a1, b1, a2, b2) {
    	debugger
        let x = (b2 - b1) / (a1 - a2);
        let y = a1 * x + b1;
        return {latitude: x, longitude: y};
    }

    //  å°†ç»çº¬åº¦åæ ‡ç³»å•ä½é•¿åº¦è½¬ä¸ºcanvasåæ ‡ç³»çš„å•ä½é•¿åº¦
    /**
     * @x : è¢«è½¬æ¢çš„é•¿åº¦  [è¢«æ¢ç®—æˆå°æ•°ç‚¹çš„ç»çº¬åº¦åæ ‡ç³»][northernLatitude]
     * */
    function transformLongitudeAndLatitudeToCartesianCoordinateSystem(x) {
        return x * getRatio;
    }
</script>
<script>
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;


    const _corner = transformOriginData(corner);
    //  ç‚¹çš„ç®€å†™
    let bl = _corner.bottomLeft;
    let br = _corner.bottomRight;
    //  è·å¾—åº•è¾¹æ–œç‡k, å’Œb
    let bottomLineParams = getK_B(br.latitude, br.longitude, bl.latitude, bl.longitude);
    console.log('åº•è¾¹k,bå¯¹è±¡', bottomLineParams);
    let tl = _corner.topLeft;
    //  è·å¾—å·¦è¾¹æ–œç‡k,å’Œb
    let leftLineParams = getK_B(tl.latitude, tl.longitude, bl.latitude, bl.longitude);
    console.log('å·¦è¾¹k,bå¯¹è±¡', leftLineParams);


    //  æ ¹æ®å·¦ä¸‹è§’å’Œå³ä¸‹è§’æ±‚åº•è¾¹åœ¨canvasåæ ‡ç³»ä¸‹çš„é•¿åº¦
    let bottom_differ = getDiffer(bl.latitude, bl.longitude, br.latitude, br.longitude);
    //  å•ä½ç»çº¬åº¦åæ ‡ç³»é•¿åº¦ç›¸å½“äºnä¸ªåƒç´ çš„æ¯”ä¾‹,æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°
    let getRatio = canvas.width / bottom_differ;
    let left_differ = getDiffer(bl.latitude, bl.longitude, tl.latitude, tl.longitude);


    let image = new Image();
    image.onload = function () {
        canvas.height = window.innerWidth * this.height / this.width;
        drawMap();

        (function () {
             // æµ‹è¯•å››è§’--è¯æ˜åæ ‡ç³»å‡†ç¡®æ€§
            __testCorner(bottom_differ, left_differ, bottomLineParams.k * leftLineParams.k)
        }());
        console.clear();

        debugger

        //  ç»˜åˆ¶æŸä¸ªå®é™…çš„ç‚¹ä½
        let __point = calculatePoint(StartPoint);
        //  ç»˜åˆ¶æŸä¸ªç‚¹
        drawMarker(__point);

    };
    image.src = '../libs/img/map4.jpg';

    //  è®¡ç®—è¯¥ç‚¹åœ¨canvasåæ ‡ç³»ä¸‹çš„åæ ‡
    /**
     * @_cAUP   ç”¨äºè®¡ç®—åæ ‡çš„åæ ‡ç‚¹  [è¢«æ¢ç®—æˆå°æ•°ç‚¹çš„ç»çº¬åº¦åæ ‡ç³»][northernLatitude]
     * @params  canvasçš„è¾¹
     * */
    function calculateCoordinate(_cAUP, params) {
    	debugger
        //  è¯¥ç‚¹ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„ b
        let _k = -1 / params.k;
        let b = get_B(_cAUP.latitude, _cAUP.longitude, _k);
        //  è¯¥ç‚¹åœ¨ç»çº¬åº¦åæ ‡ç³»ä¸‹ä¸åº•è¾¹çš„ç„¦ç‚¹åæ ‡
        let focalCoordinates = getFocalCoordinates(_k, b, params.k, params.b);
        //  è·å¾—è¯¥ç‚¹å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹  çš„ç»çº¬åº¦åæ ‡
        // console.log('è·å¾—è¯¥ç‚¹å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹ çš„ ç»çº¬åº¦åæ ‡', focalCoordinates);
        //  æ±‚å¾—è¿™ä¸ªaç‚¹ä¸å·¦ä¸‹è§’ç‚¹çš„ç»å¯¹é•¿åº¦å·®,è¿™ä¸ªç‚¹æ˜¯è¯¥ç‚¹çš„åœ¨canvasåæ ‡ç³»ä¸‹ çš„ å®é™…çš„ x
        let bottom_diff = getDiffer(bl.latitude, bl.longitude, focalCoordinates.latitude, focalCoordinates.longitude);
        // console.log('å®é™…çš„ x', bottom_diff);
        return bottom_diff;
    }

    //  ç»˜åˆ¶åœ°å›¾
    function drawMap() {
        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }


    //  è®¡ç®—ç‚¹ä½ï¼Œä»ç»çº¬åº¦åæ ‡ è®¡ç®— ä¸º canvasåæ ‡ç³»åæ ‡
    /**
     * @point : [ChinaAgriculturalUniversityPoints]
     * */
    function calculatePoint(point) {
        //  æŸä¸ªç‚¹çš„æ•°æ®
        const __point = {
            longitude: point.longitude,
            latitude: point.latitude * northernLatitude,
        };
        //  æ¢ç®—ä¸ºcanvasåæ ‡ç³»åçš„åæ ‡
        // const __point = {
        //     x: calculateCoordinate(_point, bottomLineParams),
        //     y: calculateCoordinate(_point, leftLineParams)
        // };
        return {
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(__point.x),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(__point.y)
        };
    }

    //  ç»˜åˆ¶marker
    /**
     * @point : ç‚¹ [canvasåæ ‡ç³»]
     * */
    function drawMarker(point) {
        ctx.beginPath();
        ctx.arc(point.x, canvas.height - point.y, 11.11, 0, 2 * Math.PI);
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.fillStyle = 'blue';
        ctx.fill();
        ctx.closePath();
    }

    //  æµ‹è¯•  å››è§’å®šä½
    /**
     * @bottom_differ
     * @left_differ
     * @productOfSlope
     * */
    function __testCorner(bottom_differ, left_differ, productOfSlope) {
        console.log('*******************************å››è§’å®šä½æµ‹è¯•*******************************');
        console.log('bottom_differ  :   åº•è¾¹åœ¨ç»çº¬åº¦åæ ‡ä¸‹çš„é•¿åº¦', bottom_differ);
        let width_rate_bottom = canvas.width / bottom_differ;
        console.log('width_rate :      æ¯ä¸ªå•ä½ç›¸å½“äº  ** ä¸ªåƒç´ ', width_rate_bottom);

        console.log('left_differ  :     å·¦è¾¹åœ¨ç»çº¬åº¦åæ ‡ä¸‹çš„é•¿åº¦', left_differ);
        let width_rate_left = canvas.height / left_differ;
        console.log('width_rate_left : æ¯ä¸ªå•ä½ç›¸å½“äº  ** ä¸ªåƒç´ ', width_rate_left);
        console.log('width_rate_bottom åº”è¯¥ç­‰äº width_rate', Math.floor(width_rate_bottom), Math.floor(width_rate_left));

        console.log('\n', 'å››è§’åæ ‡', _corner, '\n\t');
        console.log('ä¸¤è¾¹æ–œç‡ä¹˜ç§¯ , è¶Šæ¥è¿‘ -1 è¶Šç²¾ç¡®', productOfSlope);

        console.log('*******************************å››è§’å®šä½æµ‹è¯•*******************************');
        //  ç»˜åˆ¶å››è§’å®šä½ç‚¹
        testDraw(bottom_differ, left_differ);
    }

    //  æµ‹è¯•
    function testDraw(bottom_differ, left_differ) {
        //  testå³ä¸‹è§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(Number(bottom_differ)),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0)
        });
        //  testå³ä¸Šè§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(Number(bottom_differ)),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(left_differ)
        });
        //  testå·¦ä¸Šè§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(left_differ)
        });
        //  testå·¦ä¸‹è§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0)
        });
    }
</script>
</body>
</html>
