<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>åæ ‡</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			display: block;
			outline: 1px solid red;
		}
	</style>
</head>
<body>
<canvas id="canvas"></canvas>
<script title="æ•°æ®">
    //  å››ä¸ªè§’è½çš„åæ ‡
    const corner = (function () {
        return {
            topLeft: {
                longitude: unescape("40%B005'11.39\""),
                latitude: unescape("116%B021'21.31\""),
            },
            topRight: {
                longitude: unescape("39%B058'32.81\""),
                latitude: unescape("116%B034'59.30\""),
            },
            bottomLeft: {
                longitude: unescape("39%B056'17.72\""),
                latitude: unescape("116%B014'38.61\""),
            },
            bottomRight: {
                longitude: unescape("39%B050'04.76\""),
                latitude: unescape("116%B028'12.93\""),
            }
        }
    }());
    const northernLatitude = Math.cos(Math.PI * (35 / 180));
    console.log('å½“å‰çº¬åº¦ä¸‹,æ¯ä¸ªç»åº¦ç›¸å½“äº  ' + northernLatitude + '  ä¸ªçº¬åº¦');

    //  å¤©å®‰é—¨é™„è¿‘
    const tianAnMen = {
        longitude: unescape("40%B00'13.09\""),
        latitude: unescape("116%B021'3.44\""),
    }


</script>
<script title="å·¥å…·ç±»">
    //  å°†ç»å¯¹åæ ‡è½¬ä¸ºå°æ•°ç‚¹çš„åº¦æ•°    --- è½¬æ¢ç»†èŠ‚           ğŸ‘ŒğŸ‘Œ
    function transformRadioToFloat(radio) {
        let degreesArr = radio.split('Â°');
        let degrees = Number(degreesArr[0]);
        let minuteArr = degreesArr[1].split('\'');
        let minutes = Number(minuteArr[0]);
        let secondArr = minuteArr[1].split('.');
        let seconds = Number(secondArr[0]);
        let dotS = Number(secondArr[1].slice(0, -1));
        // console.log(degrees, minutes, seconds, dotS);
        // console.log(degrees, minutes / 60, seconds / 60 / 60, dotS / 60 / 60 / 100);
        return degrees + minutes / 60 + seconds / 60 / 60 + dotS / 60 / 60 / 100;
    }


    //  è½¬æ¢å…¨éƒ¨æ•°æ®                                  ğŸ‘ŒğŸ‘Œ          !!!!!!!         x northernLatitude
    function transformOriginData(originData) {
        const _data = {};
        for (let key in originData) {
            if (originData.hasOwnProperty(key)) {
                _data[key] = {
                    longitude: transformRadioToFloat(originData[key].longitude),
                    latitude: transformRadioToFloat(originData[key].latitude) * northernLatitude
                }
            }
        }
        return _data;
    }

    //  è·å–ç¬›å¡å°”åæ ‡ç³»çš„ç»å¯¹å·®å€¼                           ğŸ‘ŒğŸ‘Œ
    function getDiffer(diff, origin) {
        return Math.sqrt(Math.pow(diff.longitude - origin.longitude, 2) + Math.pow(diff.latitude - origin.latitude, 2))
    }

    //  è®¡ç®—å››ä¸ªè§’çš„åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸‹çš„ç»å¯¹å€¼
    function calculateCorner(rangeData) {
        const data = transformOriginData(rangeData);
        // console.log(data);
        return data;
        //  ç»çº¬åº¦åœ¨ç¬›å¡å°”åæ ‡ç³»ä¸‹çš„ç»å¯¹ä½ç½®ï¼Œä»¥å·¦ä¸‹è§’ä¸ºåŸç‚¹
        return {
            bottomLeft: {
                diffY: 0,
                diffX: 0
            },
            topLeft: {
                diffY: getDiffer(data.topLeft, data.bottomLeft),
                diffX: 0
            },
            bottomRight: {
                diffY: 0,
                diffX: getDiffer(data.bottomRight, data.bottomLeft)
            }
        };
    }


    //  è·å–æœ¬åœ°å›¾ä¸‹çš„çœŸå®åæ ‡ åæ ‡åŸç‚¹æ˜¯ç¬›å¡å°”åæ ‡ç³»åŸç‚¹ å•ä½px      ğŸ‘ŒğŸ‘Œ
    function getRealRatio(_differ, differ, canvas) {
        return {
            x: _differ.diffX / differ.diffX * canvas.width,
            y: canvas.height - _differ.diffY / differ.diffY * canvas.height,
        }
    }


    //  æ±‚ä¸¤ç‚¹è¿çº¿çš„æ–¹ç¨‹
    function getFn(x1, y1, x2, y2) {
        let k = (y2 - y1) / (x2 - x1);
        let b = y1 - k * x1;
        console.log(k, b);
    }


</script>
<script>

    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    let image = new Image();
    image.onload = function () {
        canvas.height = window.innerWidth * this.height / this.width;
        drawMap();


        //  åœ°å›¾å››ä¸ªè§’è½
        const _corner = calculateCorner(corner);
        console.log('åœ°å›¾å››ä¸ªè§’è½', _corner);

        //  ä¸‹è¾¹çš„æ–œçº¿æ–¹ç¨‹
        getFn(_corner.bottomLeft.latitude, _corner.bottomLeft.longitude, _corner.bottomRight.latitude, _corner.bottomRight.longitude);
        //  å·¦è¾¹çš„æ–œçº¿æ–¹ç¨‹
        getFn(_corner.bottomLeft.latitude, _corner.bottomLeft.longitude, _corner.topLeft.latitude, _corner.topLeft.longitude);


        //  ä¸­å›½å†œä¸šå¤§å­¦ç»çº¬åº¦
        const _tianAnMen = {
            longitude: transformRadioToFloat(tianAnMen.longitude),
            latitude: transformRadioToFloat(tianAnMen.latitude) * northernLatitude
        };
        console.log('ä¸­å›½å†œä¸šå¤§å­¦ç»çº¬åº¦ å·²ä¹˜ northernLatitude', _tianAnMen);
        //  è¿‡å¤©å®‰é—¨å…³äºå·¦ä¸‹è§’çš„çº¿
        getFn(_corner.bottomLeft.latitude, _corner.bottomLeft.longitude, _tianAnMen.latitude, _tianAnMen.longitude);

        const diffAbs = getDiffer(_corner.bottomLeft, _tianAnMen);
        console.log(diffAbs);



        return;
        console.log(getDiffer(_corner.bottomLeft, _corner.bottomLeft))
        drawMarker({
            x: getDiffer(_corner.bottomLeft, _corner.bottomLeft),
            y: 0
        });

    };
    image.src = '../libs/img/map2.jpg';


    //  ç»˜åˆ¶åœ°å›¾
    function drawMap() {
        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }


    //  ç»˜åˆ¶marker
    function drawMarker(point) {
        ctx.beginPath();
        ctx.arc(point.x, point.y, 30, 0, 2 * Math.PI);
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.fillStyle = ' ';
        ctx.fill();
        ctx.closePath();
    }


</script>
</body>
</html>
