<!doctype html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>åæ ‡</title>
	<style>
		body {
			margin: 0;
		}

		canvas {
			display: block;
			outline: 1px solid red;
		}
	</style>
</head>
<body>
<canvas id="canvas"></canvas>
latitude-x;
longitude-y;
<script title="æ•°æ®">

	//  å››ä¸ªè§’è½çš„åæ ‡
    const corner = (function () {
        return {
            topLeft: {
                longitude: unescape("39%B058'29.22\""),
                latitude: unescape("116%B018'39.46\""),
            },
            topRight: {
                longitude: unescape("39%B058'29.46\""),
                latitude: unescape("116%B027'2.84\""),
            },
            bottomLeft: {
                longitude: unescape("39%B051'39.75\""),
                latitude: unescape("116%B018'37.64\""),
            },
            bottomRight: {
                longitude: unescape("39%B051'36.63\""),
                latitude: unescape("116%B027'1.63\""),
            }
        }
    }());
    let northernLatitude = Math.cos(Math.PI * (39.9012361111111 / 180));
    // northernLatitude = 1;
    console.log('å½“å‰çº¬åº¦ä¸‹,æ¯ä¸ªç»åº¦ç›¸å½“äº  ' + northernLatitude + '  ä¸ªçº¬åº¦');

    //  ä¸­å›½å†œå¤§
    // const ChinaAgriculturalUniversityPoints = {
    //     longitude: unescape("40%B00'16.96\""),
    //     latitude: unescape("116%B021'7.49\""),
    // }
    //  å¤©å®‰é—¨
    // const ChinaAgriculturalUniversityPoints = {
    //     longitude: unescape("39%B054'9.32\""),
    //     latitude: unescape("116%B023'30.84\""),
    // }
    //  åŒ—äº¬ç«™
    // const ChinaAgriculturalUniversityPoints = {
    //     longitude: unescape("39%B054'5.44\""),
    //     latitude: unescape("116%B025'15.82\""),
    // }
     // åŒ—äº¬ä¸œç«™
    // const ChinaAgriculturalUniversityPoints = {
    //     longitude: unescape("39%B054'5.79\""),
    //     latitude: unescape("116%B028'45.16\""),
    // }

    //  åŒ—å¸ˆå¤§
    const ChinaAgriculturalUniversityPoints = {
        longitude: unescape("39%B057'33.09\""),
        latitude: unescape("116%B021'37.14\""),
    }
</script>
<script title="å·¥å…·ç±»">
    //  å°†ç»å¯¹åæ ‡è½¬ä¸ºå°æ•°ç‚¹çš„åº¦æ•°    --- è½¬æ¢ç»†èŠ‚           ğŸ‘ŒğŸ‘Œ
    function transformRadioToFloat(radio) {
        let degreesArr = radio.split('Â°');
        let degrees = Number(degreesArr[0]);
        let minuteArr = degreesArr[1].split('\'');
        let minutes = Number(minuteArr[0]);
        let secondArr = minuteArr[1].split('.');
        let seconds = Number(secondArr[0]);
        let dotS = Number(secondArr[1].slice(0, -1));
        return degrees + minutes / 60 + seconds / 60 / 60 + dotS / 60 / 60 / 100;
    }


    //  è½¬æ¢å…¨éƒ¨æ•°æ®                                  ğŸ‘ŒğŸ‘Œ          !!!!!!!         x northernLatitude
    function transformOriginData(originData) {
        const _data = {};
        for (let key in originData) {
            if (originData.hasOwnProperty(key)) {
                _data[key] = {
                    longitude: transformRadioToFloat(originData[key].longitude),
                    latitude: transformRadioToFloat(originData[key].latitude) * northernLatitude
                }
            }
        }
        return _data;
    }

    //  è·å–ç¬›å¡å°”åæ ‡ç³»çš„ç»å¯¹å·®å€¼                           ğŸ‘ŒğŸ‘Œ
    function getDiffer(x1, y1, x2, y2) {
        return Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
    }

    //  æ±‚ä¸¤ç‚¹è¿çº¿çš„æ–¹ç¨‹
    function getK_B(x1, y1, x2, y2) {
        let k = (y2 - y1) / (x2 - x1);
        let b = y1 - k * x1;
        return {
            k: k,
            b: b
        }
    }

    //  å·²çŸ¥,x,y,k,æ±‚ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„b
    function get_B(x, y, k) {
        return y - k * x;
    }

    //  è”ç«‹æ–¹ç¨‹,æ±‚ç„¦ç‚¹åæ ‡
    function getFocalCoordinates(a1, b1, a2, b2) {
        let x = (b2 - b1) / (a1 - a2);
        let y = a1 * x + b1;
        return {x: x, y: y};
    }

    //  å°†ç»çº¬åº¦åæ ‡ç³»å•ä½é•¿åº¦è½¬ä¸ºcanvasåæ ‡ç³»çš„å•ä½é•¿åº¦
    function transformLongitudeAndLatitudeToCartesianCoordinateSystem(x) {
        return x * getRatio;
    }

</script>
<script>

    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    //  å•ä½ç»çº¬åº¦åæ ‡ç³»é•¿åº¦ç›¸å½“äºnä¸ªåƒç´ çš„æ¯”ä¾‹,æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°
    let getRatio = 0;
    let image = new Image();
    image.onload = function () {
        canvas.height = window.innerWidth * this.height / this.width;
        drawMap();
        //  cornerè½¬ä¸ºç»çº¬åº¦æ•°å€¼çš„ç»“æœ
        const cornerAbs = transformOriginData(corner);
        console.log(JSON.stringify(cornerAbs), cornerAbs);

        let bl = cornerAbs.bottomLeft;
        let br = cornerAbs.bottomRight;
        //  è·å¾—åº•è¾¹æ–œç‡k, å’Œb
        let bottomLineParams = getK_B(br.latitude, br.longitude, bl.latitude, bl.longitude);
        console.log('åº•è¾¹', bottomLineParams);
        let tl = cornerAbs.topLeft;
        //  è·å¾—å·¦è¾¹æ–œç‡k,å’Œb
        let leftLineParams = getK_B(tl.latitude, tl.longitude, bl.latitude, bl.longitude);
        console.log('å·¦è¾¹', leftLineParams);

        // è¯æ˜åæ ‡ç³»å‡†ç¡®æ€§
        (function () {
            //  æ ¹æ®å·¦ä¸‹è§’å’Œå³ä¸‹è§’æ±‚åº•è¾¹åœ¨canvasåæ ‡ç³»ä¸‹çš„é•¿åº¦
            let bottom_differ = getDiffer(bl.latitude, bl.longitude, br.latitude, br.longitude);
            console.log('bottom_differ  :   åº•è¾¹åœ¨ç»çº¬åº¦åæ ‡ä¸‹çš„é•¿åº¦', bottom_differ);
            // let width_rate_bottom    = canvas.width / bottom_differ;
            getRatio = canvas.width / bottom_differ;
            // console.log('width_rate :      æ¯ä¸ªå•ä½ç›¸å½“äº  ** ä¸ªåƒç´ ', width_rate_bottom);
            let left_differ = getDiffer(bl.latitude, bl.longitude, tl.latitude, tl.longitude);
            console.log('left_differ  :   åº•è¾¹åœ¨ç»çº¬åº¦åæ ‡ä¸‹çš„é•¿åº¦', left_differ);
            // let width_rate_left = canvas.height / left_differ;
            // console.log('width_rate_left : æ¯ä¸ªå•ä½ç›¸å½“äº  ** ä¸ªåƒç´ ', width_rate_left);
            console.log('ä¸¤è¾¹æ–œç‡ä¹˜ç§¯', bottomLineParams.k * leftLineParams.k)

             // æµ‹è¯•
            testDraw(bottom_differ, left_differ);
        }());

        //  ä¸­å›½å†œå¤§åæ ‡
        (function () {
            let _cAUP = {
                longitude: transformRadioToFloat(ChinaAgriculturalUniversityPoints.longitude),
                latitude: transformRadioToFloat(ChinaAgriculturalUniversityPoints.latitude) * northernLatitude,
            };
            // console.clear();
            console.log('ä¸­å›½å†œå¤§åæ ‡', _cAUP);


            //  æ±‚xåæ ‡
            const _x = (function () {
                //  ä¸­å›½å†œå¤§ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„ b
                let _k = -1 / bottomLineParams.k;
                let b = get_B(_cAUP.latitude, _cAUP.longitude, _k);
                //  ä¸­å›½å†œå¤§åœ¨ç»çº¬åº¦åæ ‡ç³»ä¸‹ä¸åº•è¾¹çš„ç„¦ç‚¹åæ ‡
                let focalCoordinates = getFocalCoordinates(_k, b, bottomLineParams.k, bottomLineParams.b);
                focalCoordinates.latitude = focalCoordinates.x;
                focalCoordinates.longitude = focalCoordinates.y;
                delete focalCoordinates.x;
                delete focalCoordinates.y;

                //  è·å¾—ä¸­å›½å†œå¤§å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹  çš„ç»çº¬åº¦åæ ‡
                console.log('è·å¾—ä¸­å›½å†œå¤§å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹ çš„ ç»çº¬åº¦åæ ‡', focalCoordinates);

                //  æ±‚å¾—è¿™ä¸ªaç‚¹ä¸å·¦ä¸‹è§’ç‚¹çš„ç»å¯¹é•¿åº¦å·®,è¿™ä¸ªç‚¹æ˜¯ä¸­å›½å†œå¤§çš„åœ¨canvasåæ ‡ç³»ä¸‹ çš„ å®é™…çš„ x
                let bottom_diff = getDiffer(bl.latitude, bl.longitude, focalCoordinates.latitude, focalCoordinates.longitude);
                console.log('å®é™…çš„ x', bottom_diff);
                return bottom_diff;
            }());

            //  æ±‚yåæ ‡
            const _y = (function () {
                //  ä¸­å›½å†œå¤§ä¸€å…ƒä¸€æ¬¡æ–¹ç¨‹çš„ b
                let _k = -1 / leftLineParams.k;
                let b = get_B(_cAUP.latitude, _cAUP.longitude, _k);
                //  ä¸­å›½å†œå¤§åœ¨ç»çº¬åº¦åæ ‡ç³»ä¸‹ä¸å·¦çš„ç„¦ç‚¹åæ ‡
                let focalCoordinates = getFocalCoordinates(_k, b, leftLineParams.k, leftLineParams.b);
                focalCoordinates.latitude = focalCoordinates.x;
                focalCoordinates.longitude = focalCoordinates.y;
                delete focalCoordinates.x;
                delete focalCoordinates.y;
                //  è·å¾—ä¸­å›½å†œå¤§å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹  çš„ç»çº¬åº¦åæ ‡
                console.log('è·å¾—ä¸­å›½å†œå¤§å…³äºcanvasåæ ‡ç³»åº•è¾¹ç„¦ç‚¹ çš„ ç»çº¬åº¦åæ ‡', focalCoordinates);

                //  æ±‚å¾—è¿™ä¸ªaç‚¹ä¸å·¦ä¸‹è§’ç‚¹çš„ç»å¯¹é•¿åº¦å·®,è¿™ä¸ªç‚¹æ˜¯ä¸­å›½å†œå¤§çš„åœ¨canvasåæ ‡ç³»ä¸‹ çš„ å®é™…çš„ y
                let left_diff = getDiffer(bl.latitude, bl.longitude, focalCoordinates.latitude, focalCoordinates.longitude);
                console.log('å®é™…çš„ y', left_diff);
                return left_diff;
            }());

            //  ä¸­å›½å†œå¤§xåæ ‡ç‚¹
            drawMarker({
                x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(_x),
                y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(_y)
            });
        }());
    };
    image.src = '../libs/img/map-forward.jpg';


    //  ç»˜åˆ¶åœ°å›¾
    function drawMap() {
        ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
    }


    //  ç»˜åˆ¶marker
    function drawMarker(point) {
        ctx.beginPath();
        ctx.arc(point.x, canvas.height - point.y, 5, 0, 2 * Math.PI);
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 4;
        ctx.stroke();
        ctx.fillStyle = ' ';
        ctx.fill();
        ctx.closePath();

    }

    //  æ–‡å­—
    function drawText(point) {
        ctx.fillStyle = 'red';
        ctx.font = 'bold 34px Arial';
        ctx.fillText('è¿˜!æœ‰!è°!', point.x, canvas.height - point.y, 360, 10);
    }


    //  æµ‹è¯•
    function testDraw(bottom_differ, left_differ) {
        //  testå³ä¸‹è§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(bottom_differ),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0)
        });
        //  testå³ä¸Šè§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(bottom_differ),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(left_differ)
        });
        //  testå·¦ä¸Šè§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(left_differ)
        });
        //  testå·¦ä¸‹è§’
        drawMarker({
            x: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0),
            y: transformLongitudeAndLatitudeToCartesianCoordinateSystem(0)
        });
    }
</script>
</body>
</html>
